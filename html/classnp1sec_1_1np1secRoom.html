<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>(n+1)sec: np1sec::np1secRoom Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">(n+1)sec
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacenp1sec.html">np1sec</a></li><li class="navelem"><a class="el" href="classnp1sec_1_1np1secRoom.html">np1secRoom</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classnp1sec_1_1np1secRoom-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">np1sec::np1secRoom Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Manage all sessions associated to a room, this is follow the concurrent join protocol described in the <a class="el" href="namespacenp1sec.html" title="Multiparty Off-the-Record Messaging library Copyright (C) 2014, eQualit.ie. ">np1sec</a> spec.  
 <a href="classnp1sec_1_1np1secRoom.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="room_8h_source.html">room.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aee813eb6ecb1732adc72e00fffa387e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#aee813eb6ecb1732adc72e00fffa387e5">np1secRoom</a> (std::string room_name, <a class="el" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a> *<a class="el" href="classnp1sec_1_1np1secRoom.html#a8612c80da4fe2e2925d4b2d162869cad">user_state</a>, std::vector&lt; std::string &gt; participants_in_the_room)</td></tr>
<tr class="memdesc:aee813eb6ecb1732adc72e00fffa387e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">constructor: sets room name, make the user status joing by default.  <a href="#aee813eb6ecb1732adc72e00fffa387e5">More...</a><br /></td></tr>
<tr class="separator:aee813eb6ecb1732adc72e00fffa387e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bddc54d9343c4d9383b0af334cd4395"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a0bddc54d9343c4d9383b0af334cd4395">np1secRoom</a> ()</td></tr>
<tr class="memdesc:a0bddc54d9343c4d9383b0af334cd4395"><td class="mdescLeft">&#160;</td><td class="mdescRight">bad constructor just for the sake of operator[] of chatrooms  <a href="#a0bddc54d9343c4d9383b0af334cd4395">More...</a><br /></td></tr>
<tr class="separator:a0bddc54d9343c4d9383b0af334cd4395"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a052e2d04e594b784f2d2eec01648c134"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a052e2d04e594b784f2d2eec01648c134">np1secRoom</a> (const <a class="el" href="classnp1sec_1_1np1secRoom.html">np1secRoom</a> &amp;rhs)</td></tr>
<tr class="separator:a052e2d04e594b784f2d2eec01648c134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a326fa8ca5496cbd69a939787ab4b1a63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a326fa8ca5496cbd69a939787ab4b1a63">join</a> ()</td></tr>
<tr class="memdesc:a326fa8ca5496cbd69a939787ab4b1a63"><td class="mdescLeft">&#160;</td><td class="mdescRight">called by UserState, everytime the user trys to join a room it just simply send a join message to the room.  <a href="#a326fa8ca5496cbd69a939787ab4b1a63">More...</a><br /></td></tr>
<tr class="separator:a326fa8ca5496cbd69a939787ab4b1a63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1990072794691aacf204c52ffb5ce24a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a1990072794691aacf204c52ffb5ce24a">try_rejoin</a> ()</td></tr>
<tr class="memdesc:a1990072794691aacf204c52ffb5ce24a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If the user is joiner and already has constructed a session for the room and for any reason haven't received a reply from current participant this functions resend the join request.  <a href="#a1990072794691aacf204c52ffb5ce24a">More...</a><br /></td></tr>
<tr class="separator:a1990072794691aacf204c52ffb5ce24a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ddbff1e36193dd42620f720cc0318ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a1ddbff1e36193dd42620f720cc0318ff">solitary_join</a> ()</td></tr>
<tr class="memdesc:a1ddbff1e36193dd42620f720cc0318ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">called by room constructor, everytime the user is the first joiner of an empty room and hence does not need to convince anybody about their identity, etc.  <a href="#a1ddbff1e36193dd42620f720cc0318ff">More...</a><br /></td></tr>
<tr class="separator:a1ddbff1e36193dd42620f720cc0318ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fc3866f823fdb905a13b819059dcdbe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a5fc3866f823fdb905a13b819059dcdbe">receive_handler</a> (<a class="el" href="classnp1sec_1_1np1secMessage.html">np1secMessage</a> received_message)</td></tr>
<tr class="memdesc:a5fc3866f823fdb905a13b819059dcdbe"><td class="mdescLeft">&#160;</td><td class="mdescRight">manages the finite state machine of the sid part of the message based on sid (or absence of it), it decides what to do with the message  <a href="#a5fc3866f823fdb905a13b819059dcdbe">More...</a><br /></td></tr>
<tr class="separator:a5fc3866f823fdb905a13b819059dcdbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5afeae9cc318876e4efe6dcd683e6a8b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a5afeae9cc318876e4efe6dcd683e6a8b">send_user_message</a> (std::string plain_message)</td></tr>
<tr class="memdesc:a5afeae9cc318876e4efe6dcd683e6a8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">sends user message given in plain text by the client to the active session of the room  <a href="#a5afeae9cc318876e4efe6dcd683e6a8b">More...</a><br /></td></tr>
<tr class="separator:a5afeae9cc318876e4efe6dcd683e6a8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5ea5bdb0ad5621c2fc229b4b888da8e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#af5ea5bdb0ad5621c2fc229b4b888da8e">leave</a> ()</td></tr>
<tr class="memdesc:af5ea5bdb0ad5621c2fc229b4b888da8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Just sends a message for closing the transcript consistency this also initiate the new session creation for other users.  <a href="#af5ea5bdb0ad5621c2fc229b4b888da8e">More...</a><br /></td></tr>
<tr class="separator:af5ea5bdb0ad5621c2fc229b4b888da8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76c0f0834f27704e61d54f8a32f7902b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a76c0f0834f27704e61d54f8a32f7902b">shrink</a> (std::string leaving_user_nick)</td></tr>
<tr class="memdesc:a76c0f0834f27704e61d54f8a32f7902b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Just sends a message for closing the transcript consistency this also initiate the new session creation for other users.  <a href="#a76c0f0834f27704e61d54f8a32f7902b">More...</a><br /></td></tr>
<tr class="separator:a76c0f0834f27704e61d54f8a32f7902b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7f37a22b0f10bd7dfc8192c3a59ade7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#ab7f37a22b0f10bd7dfc8192c3a59ade7">increment_size</a> ()</td></tr>
<tr class="memdesc:ab7f37a22b0f10bd7dfc8192c3a59ade7"><td class="mdescLeft">&#160;</td><td class="mdescRight">called by user state when somebody else joins the the room to keep track of the room size  <a href="#ab7f37a22b0f10bd7dfc8192c3a59ade7">More...</a><br /></td></tr>
<tr class="separator:ab7f37a22b0f10bd7dfc8192c3a59ade7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1224ae2266c06c9e763435a66248ac3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#ab1224ae2266c06c9e763435a66248ac3">insert_session</a> (<a class="el" href="classnp1sec_1_1np1secSession.html">np1secSession</a> *new_session)</td></tr>
<tr class="memdesc:ab1224ae2266c06c9e763435a66248ac3"><td class="mdescLeft">&#160;</td><td class="mdescRight">for <a class="el" href="classnp1sec_1_1np1secSession.html" title="This class is encapsulating all information and action, a user needs and performs in a session...">np1secSession</a> when it breeds a new session specailly in the forward secrecy timer to be able to insert it in the room's session map  <a href="#ab1224ae2266c06c9e763435a66248ac3">More...</a><br /></td></tr>
<tr class="separator:ab1224ae2266c06c9e763435a66248ac3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782a799b56ddc987ba2b4e8619711a0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a782a799b56ddc987ba2b4e8619711a0d">~np1secRoom</a> ()</td></tr>
<tr class="memdesc:a782a799b56ddc987ba2b4e8619711a0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor need to clean up the session universe.  <a href="#a782a799b56ddc987ba2b4e8619711a0d">More...</a><br /></td></tr>
<tr class="separator:a782a799b56ddc987ba2b4e8619711a0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr class="memitem:a875bfccdc8c131c268db48319ddfe294"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">UserInRoomState</a> { <a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983">JOINING</a>, 
<a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263">CURRENT_USER</a>
 }<tr class="separator:a875bfccdc8c131c268db48319ddfe294"><td class="memSeparator" colspan="2">&#160;</td></tr>
</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a2a4f772676df7cda4eca4931e0e681cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a2a4f772676df7cda4eca4931e0e681cf">activate_session</a> (<a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a> newly_activated_session)</td></tr>
<tr class="memdesc:a2a4f772676df7cda4eca4931e0e681cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">manages activating a session which concerns an additional person joining or an person leaving.  <a href="#a2a4f772676df7cda4eca4931e0e681cf">More...</a><br /></td></tr>
<tr class="separator:a2a4f772676df7cda4eca4931e0e681cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a6684c0640b1733c41c2c769a182e2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a9a6684c0640b1733c41c2c769a182e2f">stale_in_limbo_sessions_presume_heir</a> (<a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a> new_successor)</td></tr>
<tr class="memdesc:a9a6684c0640b1733c41c2c769a182e2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark in-limbo sessions which are not valid any more as stale so subsequently one can make a fresh session out of each mark them stale prevent them from replying to confimation etc and misleading joining participants in moving forward.  <a href="#a9a6684c0640b1733c41c2c769a182e2f">More...</a><br /></td></tr>
<tr class="separator:a9a6684c0640b1733c41c2c769a182e2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28ed10047b2014a7797854c0d9d7ce2e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a28ed10047b2014a7797854c0d9d7ce2e">refresh_stale_in_limbo_sessions</a> (<a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a> new_parent_session_id)</td></tr>
<tr class="memdesc:a28ed10047b2014a7797854c0d9d7ce2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">When a new sesison generates key we need to update all session in limbo (kill them and generate new one for each) which ad here to this generated key session.  <a href="#a28ed10047b2014a7797854c0d9d7ce2e">More...</a><br /></td></tr>
<tr class="separator:a28ed10047b2014a7797854c0d9d7ce2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:abfd15f884edae6d25ad64e287e5fa70d"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#abfd15f884edae6d25ad64e287e5fa70d">name</a></td></tr>
<tr class="separator:abfd15f884edae6d25ad64e287e5fa70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8612c80da4fe2e2925d4b2d162869cad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a8612c80da4fe2e2925d4b2d162869cad">user_state</a></td></tr>
<tr class="separator:a8612c80da4fe2e2925d4b2d162869cad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb72d7a776123832838d2cd4c87dea53"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structnp1sec_1_1ParticipantId.html">ParticipantId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#adb72d7a776123832838d2cd4c87dea53">myself</a></td></tr>
<tr class="separator:adb72d7a776123832838d2cd4c87dea53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1106255c3e2b8d9435be5a8191bd8724"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a1106255c3e2b8d9435be5a8191bd8724">room_size</a> = 0</td></tr>
<tr class="separator:a1106255c3e2b8d9435be5a8191bd8724"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb82d04345572557b9991b6de7eb8500"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">UserInRoomState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#afb82d04345572557b9991b6de7eb8500">user_in_room_state</a></td></tr>
<tr class="separator:afb82d04345572557b9991b6de7eb8500"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af655c5b09cddeefb0ab6fbc44aceac87"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnp1sec_1_1Cryptic.html">Cryptic</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#af655c5b09cddeefb0ab6fbc44aceac87">np1sec_ephemeral_crypto</a></td></tr>
<tr class="separator:af655c5b09cddeefb0ab6fbc44aceac87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d221b424196a61964ec8092fed00999"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacenp1sec.html#a0949efd59c0f4c8fed16dfeeb01bf285">SessionMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#a6d221b424196a61964ec8092fed00999">session_universe</a></td></tr>
<tr class="separator:a6d221b424196a61964ec8092fed00999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad076e7e20f8decaee92dec85f5972edb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#ad076e7e20f8decaee92dec85f5972edb">active_session</a></td></tr>
<tr class="separator:ad076e7e20f8decaee92dec85f5972edb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea68eabca1f56cdc2099adabf884505b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnp1sec_1_1np1secRoom.html#aea68eabca1f56cdc2099adabf884505b">next_in_activation_line</a></td></tr>
<tr class="separator:aea68eabca1f56cdc2099adabf884505b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manage all sessions associated to a room, this is follow the concurrent join protocol described in the <a class="el" href="namespacenp1sec.html" title="Multiparty Off-the-Record Messaging library Copyright (C) 2014, eQualit.ie. ">np1sec</a> spec. </p>
<p>The session-room invarients is that:</p><ul>
<li>All participant in active session, share the same view about who is in the active session of the room.</li>
</ul>
<p>nTherefore session creation fololws the following algorithm:</p>
<p>User is in active session:</p><ul>
<li>Receive a join join requet-&gt; make a new session immediately with session id.</li>
<li>Receive a leave requet -&gt; make a new session immediately with session id.</li>
<li>Receive a message with wrong sid -&gt; ignore.</li>
</ul>
<p>User not in the active session:</p><ul>
<li>UserState join-&gt; just send join to room without session</li>
<li>receive with existing sid -&gt; goes to sid.</li>
<li>receive with non-existing sid -&gt; generate a new session. </li>
</ul>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a875bfccdc8c131c268db48319ddfe294"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">np1sec::np1secRoom::UserInRoomState</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983"></a>JOINING&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263"></a>CURRENT_USER&#160;</td><td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aee813eb6ecb1732adc72e00fffa387e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">np1sec::np1secRoom::np1secRoom </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>room_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a> *&#160;</td>
          <td class="paramname"><em>user_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt;&#160;</td>
          <td class="paramname"><em>participants_in_the_room</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>constructor: sets room name, make the user status joing by default. </p>

</div>
</div>
<a class="anchor" id="a0bddc54d9343c4d9383b0af334cd4395"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">np1sec::np1secRoom::np1secRoom </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>bad constructor just for the sake of operator[] of chatrooms </p>

</div>
</div>
<a class="anchor" id="a052e2d04e594b784f2d2eec01648c134"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">np1sec::np1secRoom::np1secRoom </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classnp1sec_1_1np1secRoom.html">np1secRoom</a> &amp;&#160;</td>
          <td class="paramname"><em>rhs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a782a799b56ddc987ba2b4e8619711a0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">np1sec::np1secRoom::~np1secRoom </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destructor need to clean up the session universe. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a2a4f772676df7cda4eca4931e0e681cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::activate_session </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a>&#160;</td>
          <td class="paramname"><em>newly_activated_session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>manages activating a session which concerns an additional person joining or an person leaving. </p>
<p>it inform all sessions in limbo to add or drop the person.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newl_activated_session</td><td>the session that just got confirmation from all particpants and is ready to be the default session of the room </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9a6684c0640b1733c41c2c769a182e2f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::stale_in_limbo_sessions_presume_heir </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a>&#160;</td>
          <td class="paramname"><em>new_successor</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mark in-limbo sessions which are not valid any more as stale so subsequently one can make a fresh session out of each mark them stale prevent them from replying to confimation etc and misleading joining participants in moving forward. </p>

</div>
</div>
<a class="anchor" id="a28ed10047b2014a7797854c0d9d7ce2e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::refresh_stale_in_limbo_sessions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a>&#160;</td>
          <td class="paramname"><em>new_parent_session_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>When a new sesison generates key we need to update all session in limbo (kill them and generate new one for each) which ad here to this generated key session. </p>
<p>if somebody leaves, as soon as they live you need to update them cause they are useless and the leaving person aren't going to confirmed any of them </p>

</div>
</div>
<a class="anchor" id="a326fa8ca5496cbd69a939787ab4b1a63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::join </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called by UserState, everytime the user trys to join a room it just simply send a join message to the room. </p>
<p>called by room constructor, everytime the user trys to join a room occupied by others.</p>
<p>it just simply send a join message to the room. </p>

</div>
</div>
<a class="anchor" id="a1990072794691aacf204c52ffb5ce24a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::try_rejoin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If the user is joiner and already has constructed a session for the room and for any reason haven't received a reply from current participant this functions resend the join request. </p>

</div>
</div>
<a class="anchor" id="a1ddbff1e36193dd42620f720cc0318ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::solitary_join </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called by room constructor, everytime the user is the first joiner of an empty room and hence does not need to convince anybody about their identity, etc. </p>

</div>
</div>
<a class="anchor" id="a5fc3866f823fdb905a13b819059dcdbe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::receive_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1np1secMessage.html">np1secMessage</a>&#160;</td>
          <td class="paramname"><em>received_message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>manages the finite state machine of the sid part of the message based on sid (or absence of it), it decides what to do with the message </p>
<p>User is in active session:</p><ul>
<li>Receive a join join requet-&gt; make a new session immediately with session id.</li>
<li>Receive a leave requet -&gt; make a new session immediately with session id.</li>
<li>Receive a message with wrong sid -&gt; ignore.</li>
</ul>
<p>User not in the active session:</p><ul>
<li>UserState join-&gt; just send join to room without session</li>
<li>receive with existing sid -&gt; goes to sid.</li>
<li>receive with non-existing sid -&gt; generate a new session.</li>
</ul>
<p>User is in active session:</p><ul>
<li>Receive a join join requet-&gt; make a new session immediately with session id.</li>
<li>Receive a leave requet -&gt; make a new session immediately with session id.</li>
<li>Receive a message with wrong sid -&gt; ignore.</li>
</ul>
<p>User not in the active session:</p><ul>
<li>UserState join-&gt; just send join to room without session</li>
<li>receivae with existing sid -&gt; goes to sid.</li>
<li>receive with non-existing sid -&gt; generate a new session.</li>
</ul>
<p>Other messages should be deligated this way using the following procedure:</p><ol type="1">
<li>If the message has sid: if there is a live session with that sid, deligate to that session else if the message has sid but session with such sid does not exists or the session is dead if the room has active session, give it to the active sesssion of the room else make a new session for that room and deligate it to it (but it is a sort of error, ignore the message. Join message doesn't have sid)</li>
<li>If the message doesn't have sid, it is a join message if the room has active session deligate it to the active session. else (this shouldn't happen either). * </li>
</ol>

</div>
</div>
<a class="anchor" id="a5afeae9cc318876e4efe6dcd683e6a8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::send_user_message </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>plain_message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sends user message given in plain text by the client to the active session of the room </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plain_message</td><td>user text message</td></tr>
  </table>
  </dd>
</dl>
<p>throw exception if no active session is established for the current room</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">plain_message</td><td>user text message</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>false if no active session is established for the current room </dd></dl>

</div>
</div>
<a class="anchor" id="af5ea5bdb0ad5621c2fc229b4b888da8e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::leave </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Just sends a message for closing the transcript consistency this also initiate the new session creation for other users. </p>

</div>
</div>
<a class="anchor" id="a76c0f0834f27704e61d54f8a32f7902b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::shrink </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>leaving_user_nick</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Just sends a message for closing the transcript consistency this also initiate the new session creation for other users. </p>

</div>
</div>
<a class="anchor" id="ab7f37a22b0f10bd7dfc8192c3a59ade7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::increment_size </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called by user state when somebody else joins the the room to keep track of the room size </p>

</div>
</div>
<a class="anchor" id="ab1224ae2266c06c9e763435a66248ac3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void np1sec::np1secRoom::insert_session </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnp1sec_1_1np1secSession.html">np1secSession</a> *&#160;</td>
          <td class="paramname"><em>new_session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>for <a class="el" href="classnp1sec_1_1np1secSession.html" title="This class is encapsulating all information and action, a user needs and performs in a session...">np1secSession</a> when it breeds a new session specailly in the forward secrecy timer to be able to insert it in the room's session map </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="abfd15f884edae6d25ad64e287e5fa70d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string np1sec::np1secRoom::name</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a8612c80da4fe2e2925d4b2d162869cad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a>* np1sec::np1secRoom::user_state</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="adb72d7a776123832838d2cd4c87dea53"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structnp1sec_1_1ParticipantId.html">ParticipantId</a> np1sec::np1secRoom::myself</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a1106255c3e2b8d9435be5a8191bd8724"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t np1sec::np1secRoom::room_size = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="afb82d04345572557b9991b6de7eb8500"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">UserInRoomState</a> np1sec::np1secRoom::user_in_room_state</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="af655c5b09cddeefb0ab6fbc44aceac87"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnp1sec_1_1Cryptic.html">Cryptic</a> np1sec::np1secRoom::np1sec_ephemeral_crypto</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a6d221b424196a61964ec8092fed00999"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacenp1sec.html#a0949efd59c0f4c8fed16dfeeb01bf285">SessionMap</a> np1sec::np1secRoom::session_universe</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad076e7e20f8decaee92dec85f5972edb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a> np1sec::np1secRoom::active_session</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aea68eabca1f56cdc2099adabf884505b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnp1sec_1_1SessionId.html">SessionId</a> np1sec::np1secRoom::next_in_activation_line</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="room_8h_source.html">room.h</a></li>
<li>src/<a class="el" href="room_8cc.html">room.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
