<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>(n+1)sec: src/room.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">(n+1)sec
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">room.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="room_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#ifndef SRC_ROOM_H_</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define SRC_ROOM_H_</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//#error I am here</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">src/common.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="crypt_8h.html">src/crypt.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="interface_8h.html">src/interface.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="session_8h.html">src/session.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="message_8h.html">src/message.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacenp1sec.html">np1sec</a></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// The type that keep the set of all sessions associated with this room</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// It really need to be a pointer, because the sessions are mostly</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// create by other sessions and handed to the room.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// Should we point to a session or store the session itself?</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="namespacenp1sec.html#a0949efd59c0f4c8fed16dfeeb01bf285">   41</a></span>&#160;<span class="keyword">typedef</span> std::map&lt;std::string, np1secSession*&gt; <a class="code" href="namespacenp1sec.html#a0949efd59c0f4c8fed16dfeeb01bf285">SessionMap</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html">   64</a></span>&#160;<span class="keyword">class </span><a class="code" href="classnp1sec_1_1np1secRoom.html">np1secRoom</a></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keyword">protected</span>:</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#abfd15f884edae6d25ad64e287e5fa70d">   67</a></span>&#160;    std::string <a class="code" href="classnp1sec_1_1np1secRoom.html#abfd15f884edae6d25ad64e287e5fa70d">name</a>; <span class="comment">// room name given in creation by user_state</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a8612c80da4fe2e2925d4b2d162869cad">   68</a></span>&#160;    <a class="code" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a>* <a class="code" href="classnp1sec_1_1np1secRoom.html#a8612c80da4fe2e2925d4b2d162869cad">user_state</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#adb72d7a776123832838d2cd4c87dea53">   69</a></span>&#160;    <a class="code" href="structnp1sec_1_1ParticipantId.html">ParticipantId</a> <a class="code" href="classnp1sec_1_1np1secRoom.html#adb72d7a776123832838d2cd4c87dea53">myself</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a1106255c3e2b8d9435be5a8191bd8724">   70</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a1106255c3e2b8d9435be5a8191bd8724">room_size</a> = 0; <span class="comment">// we only need keep track of</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// the room size till we become a current user. after that</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// the session can take care of that</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// with exception of possibly one session, every</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// session has session id.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">   76</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">UserInRoomState</a> {</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983">   77</a></span>&#160;        <a class="code" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983">JOINING</a>, <span class="comment">//, LEAVING_USER //TODO: sit and think if we need this?</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263">   78</a></span>&#160;        <a class="code" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263">CURRENT_USER</a></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    };</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#afb82d04345572557b9991b6de7eb8500">   81</a></span>&#160;    <a class="code" href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">UserInRoomState</a> <a class="code" href="classnp1sec_1_1np1secRoom.html#afb82d04345572557b9991b6de7eb8500">user_in_room_state</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#af655c5b09cddeefb0ab6fbc44aceac87">   82</a></span>&#160;    <a class="code" href="classnp1sec_1_1Cryptic.html">Cryptic</a> <a class="code" href="classnp1sec_1_1np1secRoom.html#af655c5b09cddeefb0ab6fbc44aceac87">np1sec_ephemeral_crypto</a>; <span class="comment">// We keep ephemeral crypo constant</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// during join request to avoid repeated need for authentication</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// forward serecy procedure can update it consequently.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a6d221b424196a61964ec8092fed00999">   85</a></span>&#160;    SessionMap <a class="code" href="classnp1sec_1_1np1secRoom.html#a6d221b424196a61964ec8092fed00999">session_universe</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// list of sessions in limbo, they need to give birth to new</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// sessions in-limbo in case a user join or leave.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// std::list&lt;np1secSession*&gt; limbo; //no need for this limbo every</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// session beside current session.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#ad076e7e20f8decaee92dec85f5972edb">   92</a></span>&#160;    <a class="code" href="classnp1sec_1_1SessionId.html">SessionId</a> <a class="code" href="classnp1sec_1_1np1secRoom.html#ad076e7e20f8decaee92dec85f5972edb">active_session</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#aea68eabca1f56cdc2099adabf884505b">   93</a></span>&#160;    <a class="code" href="classnp1sec_1_1SessionId.html">SessionId</a> <a class="code" href="classnp1sec_1_1np1secRoom.html#aea68eabca1f56cdc2099adabf884505b">next_in_activation_line</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a2a4f772676df7cda4eca4931e0e681cf">activate_session</a>(<a class="code" href="classnp1sec_1_1SessionId.html">SessionId</a> newly_activated_session);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a9a6684c0640b1733c41c2c769a182e2f">stale_in_limbo_sessions_presume_heir</a>(<a class="code" href="classnp1sec_1_1SessionId.html">SessionId</a> new_successor);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a28ed10047b2014a7797854c0d9d7ce2e">refresh_stale_in_limbo_sessions</a>(<a class="code" href="classnp1sec_1_1SessionId.html">SessionId</a> new_parent_session_id);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="classnp1sec_1_1np1secRoom.html#a0bddc54d9343c4d9383b0af334cd4395">np1secRoom</a>(std::string room_name, <a class="code" href="classnp1sec_1_1np1secUserState.html">np1secUserState</a>* user_state, std::vector&lt;std::string&gt; participants_in_the_room);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a0bddc54d9343c4d9383b0af334cd4395">  135</a></span>&#160;    <a class="code" href="classnp1sec_1_1np1secRoom.html#a0bddc54d9343c4d9383b0af334cd4395">np1secRoom</a>() { assert(0); }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// we need to deep copy the session_universe</span></div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="classnp1sec_1_1np1secRoom.html#a052e2d04e594b784f2d2eec01648c134">  138</a></span>&#160;    <a class="code" href="classnp1sec_1_1np1secRoom.html#a052e2d04e594b784f2d2eec01648c134">np1secRoom</a>(<span class="keyword">const</span> <a class="code" href="classnp1sec_1_1np1secRoom.html">np1secRoom</a>&amp; rhs)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        : name(rhs.name), <span class="comment">// room name given in creation by user_state</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          user_state(rhs.user_state), myself(rhs.myself), room_size(rhs.room_size),</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          user_in_room_state(rhs.user_in_room_state), np1sec_ephemeral_crypto(rhs.np1sec_ephemeral_crypto),</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          active_session(rhs.active_session), next_in_activation_line(rhs.next_in_activation_line)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="namespacenp1sec.html#a2957dc4e0a4606a5f75c92979305aa6a">logger</a>.<a class="code" href="classnp1sec_1_1Logger.html#ac4c0b75f5dc86a79e13ed6fd2317ceed">debug</a>(<span class="stringliteral">&quot;copying room object&quot;</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; cur_session : rhs.<a class="code" href="classnp1sec_1_1np1secRoom.html#a6d221b424196a61964ec8092fed00999">session_universe</a>) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <a class="code" href="classnp1sec_1_1np1secSession.html">np1secSession</a>* new_copy = <span class="keyword">new</span> <a class="code" href="classnp1sec_1_1np1secSession.html">np1secSession</a>(*cur_session.second);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">// if rejoin timer is still active we need to activate in the copy</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            new_copy-&gt;<a class="code" href="classnp1sec_1_1np1secSession.html#a27bed3dbd5d663d75b45e4d0f963e328">clear_all_timers</a>(); <span class="comment">// it doesn&#39;t make sense to copy the</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="comment">// timer as they have pointer to the session</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">if</span> (cur_session.second-&gt;is_rejoin_timer_active())</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                new_copy-&gt;<a class="code" href="classnp1sec_1_1np1secSession.html#a5c30deecf2ddafd159916d7f8685a4a8">arm_rejoin_timer</a>();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            session_universe[new_copy-&gt;<a class="code" href="classnp1sec_1_1np1secSession.html#a369ddc7d850d78dcc6beaf783cc37770">session_id</a>.<a class="code" href="classnp1sec_1_1SessionId.html#afbef811488d4b397e8517a352a7100dc">get_as_stringbuff</a>()] = new_copy;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a326fa8ca5496cbd69a939787ab4b1a63">join</a>();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a1990072794691aacf204c52ffb5ce24a">try_rejoin</a>();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a1ddbff1e36193dd42620f720cc0318ff">solitary_join</a>();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a5fc3866f823fdb905a13b819059dcdbe">receive_handler</a>(<a class="code" href="classnp1sec_1_1np1secMessage.html">np1secMessage</a> received_message);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a5afeae9cc318876e4efe6dcd683e6a8b">send_user_message</a>(std::string plain_message);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#af5ea5bdb0ad5621c2fc229b4b888da8e">leave</a>();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#a76c0f0834f27704e61d54f8a32f7902b">shrink</a>(std::string leaving_user_nick);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#ab7f37a22b0f10bd7dfc8192c3a59ade7">increment_size</a>();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classnp1sec_1_1np1secRoom.html#ab1224ae2266c06c9e763435a66248ac3">insert_session</a>(<a class="code" href="classnp1sec_1_1np1secSession.html">np1secSession</a>* new_session);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="classnp1sec_1_1np1secRoom.html#a782a799b56ddc987ba2b4e8619711a0d">~np1secRoom</a>();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;};</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="namespacenp1sec.html#a750f7d1e7679b878336741ed115582ae">  236</a></span>&#160;<span class="keyword">typedef</span> std::map&lt;std::string, np1secSession*&gt; <a class="code" href="namespacenp1sec.html#a750f7d1e7679b878336741ed115582ae">session_room_map</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;} <span class="comment">// namespace np1sec</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#endif // SRC_ROOM_H_</span></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a5fc3866f823fdb905a13b819059dcdbe"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a5fc3866f823fdb905a13b819059dcdbe">np1sec::np1secRoom::receive_handler</a></div><div class="ttdeci">void receive_handler(np1secMessage received_message)</div><div class="ttdoc">manages the finite state machine of the sid part of the message based on sid (or absence of it)...</div><div class="ttdef"><b>Definition:</b> room.cc:171</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a1106255c3e2b8d9435be5a8191bd8724"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a1106255c3e2b8d9435be5a8191bd8724">np1sec::np1secRoom::room_size</a></div><div class="ttdeci">size_t room_size</div><div class="ttdef"><b>Definition:</b> room.h:70</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a0bddc54d9343c4d9383b0af334cd4395"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a0bddc54d9343c4d9383b0af334cd4395">np1sec::np1secRoom::np1secRoom</a></div><div class="ttdeci">np1secRoom()</div><div class="ttdoc">bad constructor just for the sake of operator[] of chatrooms </div><div class="ttdef"><b>Definition:</b> room.h:135</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a1990072794691aacf204c52ffb5ce24a"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a1990072794691aacf204c52ffb5ce24a">np1sec::np1secRoom::try_rejoin</a></div><div class="ttdeci">void try_rejoin()</div><div class="ttdoc">If the user is joiner and already has constructed a session for the room and for any reason haven&#39;t r...</div><div class="ttdef"><b>Definition:</b> room.cc:117</div></div>
<div class="ttc" id="classnp1sec_1_1Logger_html_ac4c0b75f5dc86a79e13ed6fd2317ceed"><div class="ttname"><a href="classnp1sec_1_1Logger.html#ac4c0b75f5dc86a79e13ed6fd2317ceed">np1sec::Logger::debug</a></div><div class="ttdeci">void debug(std::string msg, std::string function_name=&quot;&quot;, std::string user_nick=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> logger.cc:152</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_af5ea5bdb0ad5621c2fc229b4b888da8e"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#af5ea5bdb0ad5621c2fc229b4b888da8e">np1sec::np1secRoom::leave</a></div><div class="ttdeci">void leave()</div><div class="ttdoc">Just sends a message for closing the transcript consistency this also initiate the new session creati...</div><div class="ttdef"><b>Definition:</b> room.cc:566</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8cb4f012b45a8be1435cf79256ce0263">np1sec::np1secRoom::CURRENT_USER</a></div><div class="ttdef"><b>Definition:</b> room.h:78</div></div>
<div class="ttc" id="classnp1sec_1_1np1secSession_html"><div class="ttname"><a href="classnp1sec_1_1np1secSession.html">np1sec::np1secSession</a></div><div class="ttdoc">This class is encapsulating all information and action, a user needs and performs in a session...</div><div class="ttdef"><b>Definition:</b> session.h:133</div></div>
<div class="ttc" id="namespacenp1sec_html_a0949efd59c0f4c8fed16dfeeb01bf285"><div class="ttname"><a href="namespacenp1sec.html#a0949efd59c0f4c8fed16dfeeb01bf285">np1sec::SessionMap</a></div><div class="ttdeci">std::map&lt; std::string, np1secSession * &gt; SessionMap</div><div class="ttdef"><b>Definition:</b> room.h:41</div></div>
<div class="ttc" id="session_8h_html"><div class="ttname"><a href="session_8h.html">session.h</a></div></div>
<div class="ttc" id="classnp1sec_1_1np1secSession_html_a369ddc7d850d78dcc6beaf783cc37770"><div class="ttname"><a href="classnp1sec_1_1np1secSession.html#a369ddc7d850d78dcc6beaf783cc37770">np1sec::np1secSession::session_id</a></div><div class="ttdeci">SessionId session_id</div><div class="ttdef"><b>Definition:</b> session.h:278</div></div>
<div class="ttc" id="namespacenp1sec_html"><div class="ttname"><a href="namespacenp1sec.html">np1sec</a></div><div class="ttdoc">Multiparty Off-the-Record Messaging library Copyright (C) 2014, eQualit.ie. </div><div class="ttdef"><b>Definition:</b> base64.cc:65</div></div>
<div class="ttc" id="classnp1sec_1_1SessionId_html_afbef811488d4b397e8517a352a7100dc"><div class="ttname"><a href="classnp1sec_1_1SessionId.html#afbef811488d4b397e8517a352a7100dc">np1sec::SessionId::get_as_stringbuff</a></div><div class="ttdeci">std::string get_as_stringbuff()</div><div class="ttdef"><b>Definition:</b> session_id.h:86</div></div>
<div class="ttc" id="classnp1sec_1_1SessionId_html"><div class="ttname"><a href="classnp1sec_1_1SessionId.html">np1sec::SessionId</a></div><div class="ttdef"><b>Definition:</b> session_id.h:29</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a9a6684c0640b1733c41c2c769a182e2f"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a9a6684c0640b1733c41c2c769a182e2f">np1sec::np1secRoom::stale_in_limbo_sessions_presume_heir</a></div><div class="ttdeci">void stale_in_limbo_sessions_presume_heir(SessionId new_successor)</div><div class="ttdoc">Mark in-limbo sessions which are not valid any more as stale so subsequently one can make a fresh ses...</div><div class="ttdef"><b>Definition:</b> room.cc:423</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a875bfccdc8c131c268db48319ddfe294"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294">np1sec::np1secRoom::UserInRoomState</a></div><div class="ttdeci">UserInRoomState</div><div class="ttdef"><b>Definition:</b> room.h:76</div></div>
<div class="ttc" id="message_8h_html"><div class="ttname"><a href="message_8h.html">message.h</a></div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_ab1224ae2266c06c9e763435a66248ac3"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#ab1224ae2266c06c9e763435a66248ac3">np1sec::np1secRoom::insert_session</a></div><div class="ttdeci">void insert_session(np1secSession *new_session)</div><div class="ttdoc">for np1secSession when it breeds a new session specailly in the forward secrecy timer to be able to i...</div><div class="ttdef"><b>Definition:</b> room.cc:711</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a782a799b56ddc987ba2b4e8619711a0d"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a782a799b56ddc987ba2b4e8619711a0d">np1sec::np1secRoom::~np1secRoom</a></div><div class="ttdeci">~np1secRoom()</div><div class="ttdoc">Destructor need to clean up the session universe. </div><div class="ttdef"><b>Definition:</b> room.cc:734</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_afb82d04345572557b9991b6de7eb8500"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#afb82d04345572557b9991b6de7eb8500">np1sec::np1secRoom::user_in_room_state</a></div><div class="ttdeci">UserInRoomState user_in_room_state</div><div class="ttdef"><b>Definition:</b> room.h:81</div></div>
<div class="ttc" id="interface_8h_html"><div class="ttname"><a href="interface_8h.html">interface.h</a></div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a6d221b424196a61964ec8092fed00999"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a6d221b424196a61964ec8092fed00999">np1sec::np1secRoom::session_universe</a></div><div class="ttdeci">SessionMap session_universe</div><div class="ttdef"><b>Definition:</b> room.h:85</div></div>
<div class="ttc" id="classnp1sec_1_1np1secSession_html_a5c30deecf2ddafd159916d7f8685a4a8"><div class="ttname"><a href="classnp1sec_1_1np1secSession.html#a5c30deecf2ddafd159916d7f8685a4a8">np1sec::np1secSession::arm_rejoin_timer</a></div><div class="ttdeci">void arm_rejoin_timer()</div><div class="ttdoc">tells if rejoin is active </div><div class="ttdef"><b>Definition:</b> session.cc:1445</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a326fa8ca5496cbd69a939787ab4b1a63"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a326fa8ca5496cbd69a939787ab4b1a63">np1sec::np1secRoom::join</a></div><div class="ttdeci">void join()</div><div class="ttdoc">called by UserState, everytime the user trys to join a room it just simply send a join message to the...</div><div class="ttdef"><b>Definition:</b> room.cc:83</div></div>
<div class="ttc" id="crypt_8h_html"><div class="ttname"><a href="crypt_8h.html">crypt.h</a></div></div>
<div class="ttc" id="classnp1sec_1_1Cryptic_html"><div class="ttname"><a href="classnp1sec_1_1Cryptic.html">np1sec::Cryptic</a></div><div class="ttdoc">Encryption primitives and related definitions. </div><div class="ttdef"><b>Definition:</b> crypt.h:52</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a8612c80da4fe2e2925d4b2d162869cad"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a8612c80da4fe2e2925d4b2d162869cad">np1sec::np1secRoom::user_state</a></div><div class="ttdeci">np1secUserState * user_state</div><div class="ttdef"><b>Definition:</b> room.h:68</div></div>
<div class="ttc" id="namespacenp1sec_html_a2957dc4e0a4606a5f75c92979305aa6a"><div class="ttname"><a href="namespacenp1sec.html#a2957dc4e0a4606a5f75c92979305aa6a">np1sec::logger</a></div><div class="ttdeci">Logger logger</div></div>
<div class="ttc" id="structnp1sec_1_1ParticipantId_html"><div class="ttname"><a href="structnp1sec_1_1ParticipantId.html">np1sec::ParticipantId</a></div><div class="ttdoc">Participant id. </div><div class="ttdef"><b>Definition:</b> participant.h:39</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_ad076e7e20f8decaee92dec85f5972edb"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#ad076e7e20f8decaee92dec85f5972edb">np1sec::np1secRoom::active_session</a></div><div class="ttdeci">SessionId active_session</div><div class="ttdef"><b>Definition:</b> room.h:92</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_abfd15f884edae6d25ad64e287e5fa70d"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#abfd15f884edae6d25ad64e287e5fa70d">np1sec::np1secRoom::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> room.h:67</div></div>
<div class="ttc" id="classnp1sec_1_1np1secSession_html_a27bed3dbd5d663d75b45e4d0f963e328"><div class="ttname"><a href="classnp1sec_1_1np1secSession.html#a27bed3dbd5d663d75b45e4d0f963e328">np1sec::np1secSession::clear_all_timers</a></div><div class="ttdeci">void clear_all_timers()</div><div class="ttdoc">nullify the timers because they are not valid instead of this we need a respectable constructor ...</div><div class="ttdef"><b>Definition:</b> session.cc:1426</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a1ddbff1e36193dd42620f720cc0318ff"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a1ddbff1e36193dd42620f720cc0318ff">np1sec::np1secRoom::solitary_join</a></div><div class="ttdeci">void solitary_join()</div><div class="ttdoc">called by room constructor, everytime the user is the first joiner of an empty room and hence does no...</div><div class="ttdef"><b>Definition:</b> room.cc:46</div></div>
<div class="ttc" id="classnp1sec_1_1np1secUserState_html"><div class="ttname"><a href="classnp1sec_1_1np1secUserState.html">np1sec::np1secUserState</a></div><div class="ttdoc">Manages a user with long term identity for participating in a multiparty chat sessions. </div><div class="ttdef"><b>Definition:</b> userstate.h:42</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_adb72d7a776123832838d2cd4c87dea53"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#adb72d7a776123832838d2cd4c87dea53">np1sec::np1secRoom::myself</a></div><div class="ttdeci">ParticipantId myself</div><div class="ttdef"><b>Definition:</b> room.h:69</div></div>
<div class="ttc" id="common_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a76c0f0834f27704e61d54f8a32f7902b"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a76c0f0834f27704e61d54f8a32f7902b">np1sec::np1secRoom::shrink</a></div><div class="ttdeci">void shrink(std::string leaving_user_nick)</div><div class="ttdoc">Just sends a message for closing the transcript consistency this also initiate the new session creati...</div><div class="ttdef"><b>Definition:</b> room.cc:593</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a052e2d04e594b784f2d2eec01648c134"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a052e2d04e594b784f2d2eec01648c134">np1sec::np1secRoom::np1secRoom</a></div><div class="ttdeci">np1secRoom(const np1secRoom &amp;rhs)</div><div class="ttdef"><b>Definition:</b> room.h:138</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html">np1sec::np1secRoom</a></div><div class="ttdoc">Manage all sessions associated to a room, this is follow the concurrent join protocol described in th...</div><div class="ttdef"><b>Definition:</b> room.h:64</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a875bfccdc8c131c268db48319ddfe294a8796b2840c88dc98ad6f7d9276bab983">np1sec::np1secRoom::JOINING</a></div><div class="ttdef"><b>Definition:</b> room.h:77</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_aea68eabca1f56cdc2099adabf884505b"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#aea68eabca1f56cdc2099adabf884505b">np1sec::np1secRoom::next_in_activation_line</a></div><div class="ttdeci">SessionId next_in_activation_line</div><div class="ttdef"><b>Definition:</b> room.h:93</div></div>
<div class="ttc" id="classnp1sec_1_1np1secMessage_html"><div class="ttname"><a href="classnp1sec_1_1np1secMessage.html">np1sec::np1secMessage</a></div><div class="ttdef"><b>Definition:</b> message.h:36</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_ab7f37a22b0f10bd7dfc8192c3a59ade7"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#ab7f37a22b0f10bd7dfc8192c3a59ade7">np1sec::np1secRoom::increment_size</a></div><div class="ttdeci">void increment_size()</div><div class="ttdoc">called by user state when somebody else joins the the room to keep track of the room size ...</div><div class="ttdef"><b>Definition:</b> room.cc:586</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a5afeae9cc318876e4efe6dcd683e6a8b"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a5afeae9cc318876e4efe6dcd683e6a8b">np1sec::np1secRoom::send_user_message</a></div><div class="ttdeci">void send_user_message(std::string plain_message)</div><div class="ttdoc">sends user message given in plain text by the client to the active session of the room ...</div><div class="ttdef"><b>Definition:</b> room.cc:536</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a28ed10047b2014a7797854c0d9d7ce2e"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a28ed10047b2014a7797854c0d9d7ce2e">np1sec::np1secRoom::refresh_stale_in_limbo_sessions</a></div><div class="ttdeci">void refresh_stale_in_limbo_sessions(SessionId new_parent_session_id)</div><div class="ttdoc">When a new sesison generates key we need to update all session in limbo (kill them and generate new o...</div><div class="ttdef"><b>Definition:</b> room.cc:446</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_a2a4f772676df7cda4eca4931e0e681cf"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#a2a4f772676df7cda4eca4931e0e681cf">np1sec::np1secRoom::activate_session</a></div><div class="ttdeci">void activate_session(SessionId newly_activated_session)</div><div class="ttdoc">manages activating a session which concerns an additional person joining or an person leaving...</div><div class="ttdef"><b>Definition:</b> room.cc:391</div></div>
<div class="ttc" id="namespacenp1sec_html_a750f7d1e7679b878336741ed115582ae"><div class="ttname"><a href="namespacenp1sec.html#a750f7d1e7679b878336741ed115582ae">np1sec::session_room_map</a></div><div class="ttdeci">std::map&lt; std::string, np1secSession * &gt; session_room_map</div><div class="ttdef"><b>Definition:</b> room.h:236</div></div>
<div class="ttc" id="classnp1sec_1_1np1secRoom_html_af655c5b09cddeefb0ab6fbc44aceac87"><div class="ttname"><a href="classnp1sec_1_1np1secRoom.html#af655c5b09cddeefb0ab6fbc44aceac87">np1sec::np1secRoom::np1sec_ephemeral_crypto</a></div><div class="ttdeci">Cryptic np1sec_ephemeral_crypto</div><div class="ttdef"><b>Definition:</b> room.h:82</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
